main %>%
filter(is.na(make))
main %>%
filter(is.na(model))
main %>%
filter(is.na(drops))
main %>%
filter(drops==0)
main %>%
filter(is.na(unlock_lvl))
main %>%
filter(is.na(aero))
main %>%
filter(is.na(weight))
main %>%
filter(is.na(type))
dt[phase=='raw', dataset]
library(googlesheets4)
library(dplyr)
library(readr)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
raw_sheets <-
dt <- read_sheet(sheet_url, sheet='data_catalog')
setDT(dt)
dt[phase=='raw', dataset]
library(googlesheets4)
library(dplyr)
library(readr)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
catalog <- read_sheet(sheet_url, sheet='data_catalog')
setDT(catalog)
raw_sheets <- catalog[phase=='raw', dataset]
raw_sheets
library(googlesheets4)
library(dplyr)
library(readr)
library(data.table)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
catalog <- read_sheet(sheet_url, sheet='data_catalog')
setDT(catalog)
raw_sheets <- catalog[phase=='raw', dataset]
lapply(raw_sheets, function(focal_sheet){
write_csv(read_sheet(sheet_url, sheet=focal_sheet), paste0('data/', focal_sheet, '.csv'))
})
library(googlesheets4)
library(dplyr)
library(readr)
library(data.table)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
catalog <- read_sheet(sheet_url, sheet='data_catalog')
setDT(catalog)
raw_sheets <- catalog[phase=='raw', dataset]
for(focal_sheet in raw_sheets){
fwrite(read_sheet(sheet_url, sheet=focal_sheet), paste0('data/', focal_sheet, '.csv'))
}
library(googlesheets4)
library(dplyr)
library(readr)
library(data.table)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
catalog <- read_sheet(sheet_url, sheet='data_catalog')
setDT(catalog)
raw_sheets <- catalog[phase=='raw', dataset]
for(focal_sheet in raw_sheets){
write_csv(read_sheet(sheet_url, sheet=focal_sheet), paste0('data/', focal_sheet, '.csv'))
}
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_dropshop_frames.csv')
main
setnames(main,
old=c('Make', 'Model', 'Price', 'Level Req', 'Aero', 'Weight', 'Type'),
new=c('make', 'model', 'price', 'unlock_lvl', 'aero', 'weight', 'type'))
main
main[, frame:=paste(make, model)]
main
# Merge in name fixer here - some are make, some are model
main[, unique(make)]
main <- fread('data/raw_dropshop_frames.csv')[!is.na(Make)]
main
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_dropshop_frames.csv')[!is.na(Make)]
setnames(main,
old=c('Make', 'Model', 'Price', 'Level Req', 'Aero', 'Weight', 'Type'),
new=c('make', 'model', 'price', 'unlock_lvl', 'aero', 'weight', 'type'))
# Merge in name fixer here - some are make, some are model
main[, unique(make)]
main[, frame:=paste(make, model)]
main
# Merge in name fixer here - some are make, some are model
main[, unique(make)]
main[, unique(model)]
main[make=='BMC']
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_dropshop_frames.csv')[!is.na(Make)]
setnames(main,
old=c('Make', 'Model', 'Price', 'Level Req', 'Aero', 'Weight', 'Type'),
new=c('make', 'model', 'price', 'unlock_lvl', 'aero', 'weight', 'type'))
# Merge in name fixer here - some are make, some are model
main[, unique(make)]
main[, unique(model)]
main[make=='BMC']
main[make=='Cannondale']
main[make=='BMC' & model=='TeamMachine', model:='Teammachine']
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_dropshop_frames.csv')[!is.na(Make)]
setnames(main,
old=c('Make', 'Model', 'Price', 'Level Req', 'Aero', 'Weight', 'Type'),
new=c('frame_make', 'frame_model', 'frame_drops', 'frame_unlock_lvl', 'frame_aero', 'frame_weight', 'frame_type'))
# Merge in name fixer here - some are make, some are model
main[, unique(frame_make)]
main[, unique(frame_model)]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main
main <- fread('data/raw_zi_climb.csv', colClasses='character')
main
main <- fread('data/raw_zi_climb.csv', colClasses=rep('character',10))
main <- fread('data/raw_zi_climb.csv', colClasses=rep('character',14))
main
library(googlesheets4)
library(dplyr)
library(readr)
library(data.table)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
catalog <- read_sheet(sheet_url, sheet='data_catalog')
library(googlesheets4)
library(dplyr)
library(readr)
library(data.table)
setwd('~/github/personal/zwift/')
sheet_url <- 'docs.google.com/spreadsheets/d/100mFisQqjWB79X2N46G5aq59sTthjFHdaXxi0PZBj8A/'
catalog <- read_sheet(sheet_url, sheet='data_catalog')
setDT(catalog)
raw_sheets <- catalog[phase=='raw', dataset]
for(focal_sheet in raw_sheets){
write_csv(read_sheet(sheet_url, sheet=focal_sheet, col_types='c'), paste0('data/', focal_sheet, '.csv'))
}
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main
main[, .(frame=Bike)]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main[, .(frame=Bike, wheel=Wheels, old_time=`Old time`, time=Time, kg=Weight, watts=Watts, cm=Height)]
main[, .(frame=Bike, wheel=Wheels, old_time=`Old Time`, time=Time, kg=Weight, watts=Watts, cm=Height)]
main <- main[, .(frame=Bike, wheel=Wheels, time=Time, kg=Weight, watts=Watts, cm=Height)]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main <- main[, .(frame=Bike, wheel=Wheels, time=Time, kg=Weight, watts=Watts, cm=Height)]
main
main <- main[, .(frame=Bike, wheel=Wheels, time=Time)]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main <- main[, .(frame=Bike, wheel=Wheels, az_time=Time)]
main
main <- main[, .(frame=Bike, wheel=Wheels, type=Type, az_time=Time)]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main <- main[, .(frame=Bike, wheel=Wheels, type=Type, az_time=Time)]
main
main[, as.numeric(tstrsplit(time, ':'))]
main[, as.numeric(tstrsplit(time, ':')[[1]])]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main <- main[, .(frame=Bike, wheel=Wheels, az_time=Time)]
main[, as.numeric(tstrsplit(time, ':')[[1]])]
main[, tstrsplit(time, ':')[[1]]]
main[, tstrsplit(time, ':')]
<- main[, .(frame=Bike, wheel=Wheels, az_time=Time)]
str(main)
main[, tstrsplit(unlist(time), ':')]
main[, unlist(time)]
main[, as.numeric(tstrsplit(az_time, ':'))]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main <- main[, .(frame=Bike, wheel=Wheels, az_time=Time)]
main[, as.numeric(tstrsplit(az_time, ':'))]
main[, tstrsplit(az_time, ':')[[1]]*60]
main[, as.numeric(tstrsplit(az_time, ':')[[1]])*60]
main[, as.numeric(tstrsplit(az_time, ':')[[1]])*60 + as.numeric(tstrsplit(az_time)[[2]])]
main[, as.numeric(tstrsplit(az_time, ':')[[1]])*60 + as.numeric(tstrsplit(az_time, ':')[[2]])]
main[, as.numeric(tstrsplit(az_time, ':')[[1]])*60 + as.numeric(tstrsplit(az_time, ':')[[2]])]
main[, az_seconds:=
main[, as.numeric(tstrsplit(az_time, ':')[[1]])*60 +
as.numeric(tstrsplit(az_time, ':')[[2]])]]
main
setwd('~')
getwd()
setwd('~/../Downloads/')
library(data.table)
fread('smhi-opendata_1_82230_20240110_095418.csv')
library(ggplot2)
main[, max(temperature), by=paste0(year(date),'/',month(date))][, ggplot(.SD, aes(x=month, y=))]
main[, max(temperature), by=paste0(year(date),'/',month(date))]
main[, date=as.Date(date)]
main[, date:=as.Date(date)]
str(main)
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
main <- fread('smhi-opendata_1_82230_20240110_095418.csv')
main[, date:=as.Date(date)]
main[, max(temperature), by=paste0(year(date),'/',month(date))]
[, ggplot(.SD, aes(x=month, y=))]
main[, max(temperature), by=paste0(year(date),'/', sprintf('%02.f', month(date)))]
main[, max(temperature), by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))]
main
main[, max(temperature), by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][, ggplot(.SD, aes(x=month, y=))]
main[, .('max_temp'=max), by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][, ggplot(.SD, aes(x=date, y=))]
main[, .('max_temp'=max(temperature)), by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][, ggplot(.SD, aes(x=date, y=))]
main[, .('max_temp'=max(temperature)),
by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][
,
ggplot(.SD, aes(x=date, y=max_temp)) +
geom_line()]
main[, .('max_temp'=max(temperature)),
by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][
,
ggplot(.SD, aes(x=date, y=max_temp)) +
geom_point()]
main[, .('max_temp'=median(temperature)),
by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][
,
ggplot(.SD, aes(x=date, y=max_temp)) +
geom_point()]
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
main <- fread('smhi-opendata_1_82230_20240110_095418.csv')
main[, date:=as.Date(date)]
main[, .('max_temp'=mean(temperature)),
by=.('date'=paste0(year(date),'/', sprintf('%02.f', month(date))))][
,
ggplot(.SD, aes(x=date, y=max_temp)) +
geom_point()]
main[, .('max_temp'=mean(temperature)),
by=.('date'=paste0(year(date)))][
,
ggplot(.SD, aes(x=date, y=max_temp)) +
geom_point()]
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
temperature
temperature <- fread('smhi-opendata_1_82230_20240110_095418.csv')
temperature[, date:=as.Date(date)]
rainfall[, date:=as.Date(date)]
rainfall[, .(date, rainfall)]
rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on=date]
rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on='date']
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
temperature <- fread('smhi-opendata_1_82230_20240110_095418.csv')
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
main <- rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on='date']
main[, date:=as.Date(date)]
main[, .('max_temp'=mean(temperature)),
by=.('date'=paste0(year(date)))][
,
ggplot(.SD, aes(x=date, y=max_temp)) +
geom_point()]
main[, ggplot(.SD, aes(x=date, y=temperature)) +
geom_point()]
main
main[, ggplot(.SD, aes(x=date, y=rainfall)) +
geom_point()]
main[, max(rainfall), by=.('date'=sprintf('%4.f-%02.f', year(date), month(date)))][, ggplot(.SD, aes(x=date, y=rainfall)) +
geom_point()]
main[, max(rainfall), by=.('date'=sprintf('%4.f-%02.f', year(date), month(date)))]
main[, .('rainfall'=max(rainfall)), by=.('date'=sprintf('%4.f-%02.f', year(date), month(date)))]
[, ggplot(.SD, aes(x=date, y=rainfall)) +
main[, .('rainfall'=max(rainfall)), by=.('date'=sprintf('%4.f-%02.f', year(date), month(date)))][
, ggplot(.SD, aes(x=date, y=rainfall)) +
geom_point()]
main[, .N, by=.(year(date), rainfall>=10)]
main[, .N, by=.(year(date), rainfall>=10)][rainfall==TRUE]
main[, .N, by=.(year(date), rainfall>=10)][rainfall==TRUE][, plot(N~year)]
main[, .N, by=.(year(date), rainfall>=5)][rainfall==TRUE][, plot(N~year)]
main[, .N, by=.(year(date), rainfall>=25)][rainfall==TRUE][, plot(N~year)]
main[, .N, by=.(year(date), rainfall>=50)][rainfall==TRUE][, plot(N~year)]
main[, .N, by=.(year(date), rainfall>=30)][rainfall==TRUE][, plot(N~year)]
main[, .N, by=.(year(date), rainfall>=5)][rainfall==TRUE][, plot(N~year)]
main[, .N, by=.(year(date), rainfall>=5)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm')]
main[, .N, by=.(year(date), rainfall>=5)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=5)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=15)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
library(zoo)
main[, rollsum(rainfall, 7]
main[, rollsum(rainfall, 7)]
main[, rollsum(rainfall, 14)]
main[, rollsum(rainfall, 14, na.rm=TRUE)]
main[, c(rep(NA, 14), rollsum(rainfall, 14, na.rm=TRUE))]
main
main[, rainfall_roll:=c(rep(NA, 13), rollsum(rainfall, 14, na.rm=TRUE))]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=30)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=30)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=50)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
library(zoo)
temperature <- fread('smhi-opendata_1_82230_20240110_095418.csv')
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
main <- rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on='date']
main[, date:=as.Date(date)]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=15)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[, rainfall_roll:=c(rep(NA, 6), rollsum(rainfall, 7, na.rm=TRUE))]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=50)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=80)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=100)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=60)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=70)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[, rainfall_roll:=c(rep(NA, 29), rollsum(rainfall, 30, na.rm=TRUE))]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=15)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=70)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=300)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=100)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
library(zoo)
temperature <- fread('smhi-opendata_1_82230_20240110_095418.csv')
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
main <- rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on='date']
main[, date:=as.Date(date)]
main[, rainfall_roll:=c(rep(NA, 29), rollsum(rainfall, 30, na.rm=TRUE))]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=15)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=100)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=100)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) +
geom_point() +
geom_smooth(method='lm', se=FALSE) +
labs(x='Year', y='Number of Days where Rolling Rainfall >= 100mm')]
main
main[, shift(rainfall_roll, -1)]
main[, shift(rainfall_roll, -15)]
main[, shift(rainfall_roll, -1)>=100]
main[, ifelse(shift(rainfall_roll, -1)<100 & rainfall_roll>=100, TRUE, FALSE)]
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
library(zoo)
temperature <- fread('smhi-opendata_1_82230_20240110_095418.csv')
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
main <- rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on='date']
main[, date:=as.Date(date)]
main[, rainfall_roll:=c(rep(NA, 6), rollsum(rainfall, 7, na.rm=TRUE))]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=15)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=100)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) +
geom_point() +
geom_smooth(method='lm', se=FALSE) +
labs(x='Year', y='Number of Days where Rolling Rainfall >= 100mm')]
main[year(date)>=1900, .N, by=.(year(date), rainfall_roll>=50)][rainfall_roll==TRUE][
, ggplot(.SD, aes(year, N)) +
geom_point() +
geom_smooth(method='lm', se=FALSE) +
labs(x='Year', y='Number of Days where Rolling Rainfall >= 100mm')]
main[year(date)>=1900, .N, by=.(year(date), rainfall>=15)][rainfall==TRUE][
, ggplot(.SD, aes(year, N)) + geom_point() + geom_smooth(method='lm', se=FALSE)]
setwd('~/../Downloads/')
library(data.table)
library(ggplot2)
library(zoo)
temperature <- fread('smhi-opendata_1_82230_20240110_095418.csv')
rainfall <- fread('smhi-opendata_5_82230_20240110_100542.csv')
main <- rainfall[, .(date, rainfall)][temperature[, .('temperature'=mean(temperature)), by=date], on='date']
main[, date:=as.Date(date)]
main[, rainfall_roll:=c(rep(NA, 6), rollsum(rainfall, 7, na.rm=TRUE))]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)))]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall_roll>30)]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE][, plot(N~date)]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, plot(N~date)]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, plot(date)]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, range(date)]
main[, .N, by=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, order(date)]
main[, .N, keyby=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, order(date)]
main[, .N, keyby=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, date]
main[, .N, keyby=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, plot(date)]
main[, .N, keyby=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE, plot(as.character(date))]
main[, .N, keyby=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][rainfall==TRUE,
ggplot(.SD, aes(x=date, y=N)) + geom_point()]
main[, .N, keyby=.('date'=sprintf('%4.f/%02.f', year(date), week(date)), rainfall>10)][
rainfall==TRUE,
ggplot(.SD, aes(x=date, y=N)) + geom_point()]
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main <- main[, .(frame=Bike, wheel=Wheels, az_time=Time)]
main[, az_seconds:=
main[, as.numeric(tstrsplit(az_time, ':')[[1]])*60 +
as.numeric(tstrsplit(az_time, ':')[[2]])]]
# Fix item names
main
library(data.table)
setwd('~/github/personal/zwift/')
climb <- fread('data/raw_zi_climb.csv')
flat  <- fread('data/raw_zi_flat.csv')
climb
flat
climb[, unique(make, model)]
climb
climb[, unique(Bike)]
distinct(climb[, unique(Bike)], flat[, unique(Bike)])
distinct
?distinct
climb[, unique(Bike)]
climb[, unique(Bike)] %in% climb[, Bike]
climb[, unique(Bike)] %in% climb[, unique(Bike)]
flat[, unique(Bike)] !%in% climb[, unique(Bike)]
climb[, unique(Bike)] %in% flat[, unique(Bike)]
!(climb[, unique(Bike)] %in% flat[, unique(Bike)])
climb[!(climb[, unique(Bike)] %in% flat[, unique(Bike)])]
main <- fread('data/raw_zi_climb.csv')
library(data.table)
setwd('~/github/personal/zwift/')
main <- fread('data/raw_zi_climb.csv')
main
climb <- fread('data/raw_zi_climb.csv')
flat  <- fread('data/raw_zi_flat.csv')
climb
climb[!(climb[, unique(Bike)] %in% flat[, unique(Bike)])]
flat[, unique(Bike)] %in% climb[, unique(Bike)]
climb[!(flat[, unique(Bike)] %in% climb[, unique(Bike)])]
(flat[, unique(Bike)] %in% climb[, unique(Bike)])
climb[!(climb[, unique(Bike)] %in% flat[, unique(Bike)])]
flat[!(flat[, unique(Bike)] %in% climb[, unique(Bike)])
flat[!(flat[, unique(Bike)] %in% climb[, unique(Bike)])]
library(googlesheets4)
library(data.table)
library(ggplot2)
library(zoo)
sheet_url <- 'https://docs.google.com/spreadsheets/d/14Rs8sq71F2ArkxpO9G_VykKxpS0vTBaOGGs732Zn4qQ/'
vf <- read_sheet(sheet_url, sheet='vattenfall')
hc <- read_sheet(sheet_url, sheet='curve')
vf <- data.table(
'date'=as.Date(vf$date),
'kwh'=as.numeric(gsub(',', '.', vf$kwh)),
'temperature'=as.numeric(gsub(',', '.', vf$temperature))
)
setDT(hc)
hc[, date:=as.Date(date)]
vf <- hc[vf, on='date']
vf[, curve:=na.locf(curve, na.rm=FALSE)]
vf[curve %in% vf[, .N, by=curve][N>=10, curve] &
!is.na(curve) &
is.na(time) &
temperature <= 10,
ggplot(.SD, aes(x=temperature, y=kwh, color=as.character(curve))) +
geom_point() +
geom_smooth(method='lm', se=FALSE)
]
vf[curve %in% c(4.5, 3.6)]
hc
vf[curve %in% vf[, .N, by=curve][N>=5, curve] &
!is.na(curve) &
is.na(time) &
temperature <= 10,
ggplot(.SD, aes(x=temperature, y=kwh, color=as.character(curve))) +
geom_point() +
geom_smooth(method='lm', se=FALSE)
]
vf[curve %in% c(4.5, 3.6)]
vf[curve %in% vf[, .N, by=curve][N>=7, curve] &
!is.na(curve) &
is.na(time) &
temperature <= 10,
ggplot(.SD, aes(x=temperature, y=kwh, color=as.character(curve))) +
geom_point() +
geom_smooth(method='lm', se=FALSE)
]
