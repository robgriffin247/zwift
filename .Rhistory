# list(segment_name, segment_watts, segment_time)
segment_start
})))
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(segment, '\"start_index ')
# list(segment_name, segment_watts, segment_time)
segment_start
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(segment, '\"start_index ')
# list(segment_name, segment_watts, segment_time)
segment_start
})))
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(segment, '\"start_index":')
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(segment, '\"start_index\":')
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(segment, '\"start_index\":')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":')[1], ',')
# list(segment_name, segment_watts, segment_time)
segment_start
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":')[1], ',')
# list(segment_name, segment_watts, segment_time)
segment_start
})))
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":\":')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":\":')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\"')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index\":')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index:')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- tstrsplit(tstrsplit(segment, '\"start_index')[1], ',')[1]
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- gsub('\":', '', tstrsplit(tstrsplit(segment, '\"start_index')[1], ',')[1])
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
# segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
# segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
# segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
segment_start <- as.numeric(gsub('\":', '', tstrsplit(tstrsplit(segment, '\"start_index')[1], ',')[1]))
# list(segment_name, segment_watts, segment_time)
segment_start
})))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(segment_name, segment_watts, segment_time)
})))
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(segment_name, segment_watts, segment_time)
})))[V1!=NULL]
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
for(source_file in source_files){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
}
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(segment_name, segment_watts, segment_time)
})))[V1!=NULL]
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(segment_name, segment_watts, segment_time)
})))[V1!="NULL"]
lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(segment_name, segment_watts, segment_time)
})))[V1!="NULL"]
})
source_data
source_file
gsub('view-source_https___www.strava.com_activities_|.html','',source_file)
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_watts, segment_time)
})))[V1!="NULL"]
})
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_watts, segment_time)
})))[V2!="NULL"]
})
rbindlist(lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_watts, segment_time)
})))[V2!="NULL"]
}))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
rbindlist(lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_watts, segment_time)
})))[V2!="NULL"]
}))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
segment_results <- rbindlist(lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_watts, segment_time)
})))[V2!="NULL"]
}))
setwd('~/github/personal/zwift/')
library(data.table)
library(httr)
library(rvest)
source_files <- list.files('data/strava_sourcefiles/')
segment_results <- rbindlist(lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
#segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_time)
})))[V2!="NULL"]
}))
setnames(segment_results, c('test_id', 'segment_name', 'time'))
segment_results
write_sheet(segment_results, ss='https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='segment_results_R')
setwd('~/github/personal/zwift/')
library(data.table)
#library(httr)
library(rvest)
library(googlesheets4)
source_files <- list.files('data/strava_sourcefiles/')
segment_results <- rbindlist(lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
#segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_time)
})))[V2!="NULL"]
}))
setnames(segment_results, c('test_id', 'segment_name', 'time'))
write_sheet(segment_results, ss='https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='segment_results_R')
setwd('~/github/personal/zwift/')
library(data.table)
library(googlesheets4)
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')
setwd('~/github/personal/zwift/')
library(data.table)
library(googlesheets4)
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')
data.table(read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop'))
fwrite(data.table(read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')),
'data/dropshop.csv')
data.table(read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop'))
str(data.table(read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')))
data <- read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')
setDT(data)
data
str(data)
setwd('~/github/personal/zwift/')
library(data.table)
#library(httr)
library(rvest)
library(googlesheets4)
source_files <- list.files('data/strava_sourcefiles/')
segment_results <- rbindlist(lapply(source_files, function(source_file){
source_data <- read_html(paste0('data/strava_sourcefiles/', source_file))
source_text <- as.character(html_nodes(source_data, 'body'))
segments <- tstrsplit(tstrsplit(tstrsplit(source_text, 'preload segment efforts')[[2]],
'pageView.activity')[[1]], 'start_index')
segments[[1]] <- NULL
data.table(t(sapply(segments, function(segment){
segment_name <- unlist(tstrsplit(tstrsplit(segment, '\"name\\\":\"')[2], '\"')[1])
#segment_watts <- unlist(tstrsplit(tstrsplit(segment, '\"avg_watts\\\":\"')[2], '\\\\')[1])
segment_time <- as.numeric(tstrsplit(tstrsplit(segment, '\"elapsed_time_raw\":')[2], ',')[1])
list(gsub('view-source_https___www.strava.com_activities_|.html','',source_file) ,
segment_name, segment_time)
})))[V2!="NULL"]
}))
setnames(segment_results, c('test_id', 'segment_name', 'time'))
write_sheet(segment_results, ss='https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='r_out_segment_results')
setwd('~/github/personal/zwift/')
library(googlesheets4)
library(readr)
sheet_names <- c('dropshop', 'test_log', 'r_out_segment_results')
for(sheet_name in sheet_names){
write_csv(
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop'),
paste0('data/', sheet_name, '.csv'))
}
setwd('~/github/personal/zwift/')
library(googlesheets4)
library(readr)
sheet_names <- c('dropshop', 'test_log', 'r_out_segment_results')
for(sheet_name in sheet_names){
write_csv(
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet=sheet_name),
paste0('data/', sheet_name, '.csv'))
}
setwd('~/github/personal/zwift/')
library(googlesheets4)
library(readr)
sheet_names <- c('dropshop', 'test_log', 'r_out_segment_results')
for(sheet_name in sheet_names){
write_csv(
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet=sheet_name),
paste0('data/', sheet_name, '.csv'))
}
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')
setwd('~/github/personal/zwift/')
library(googlesheets4)
library(readr)
sheet_names <- c('dropshop', 'test_log', 'r_out_segment_results')
for(sheet_name in sheet_names){
write_csv(
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet=sheet_name),
paste0('data/', sheet_name, '.csv'))
}
read_sheet('https://docs.google.com/spreadsheets/d/1OTQfpj_nz-QSHyUl-2iwW0y2on74BK8YKJDUF03iAyk/', sheet='dropshop')
